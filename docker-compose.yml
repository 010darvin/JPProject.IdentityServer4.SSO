version: "3"

services:

    #############################
    # Database
    #############################
    jpdatabase:
      image: mysql
      command: --default-authentication-plugin=mysql_native_password
      restart: always
      environment:
          MYSQL_ROOT_PASSWORD: root
          MYSQL_USER: jp
          MYSQL_DATABASE: jpproject
          MYSQL_PASSWORD: 10203040
    
    #############################
    # Server SSO
    #############################
    jpproject:
        image: "jpproject-sso"
        build: 
          context: .
          dockerfile: sso.dockerfile
        ports:
            - "5000:5000"
        links:
            - jpdatabase
        depends_on:
            - jpdatabase
        environment: 
            DATABASE_TYPE: "SqlServer"
            CUSTOMCONNSTR_DATABASE_CONNECTION: "Data Source=tcp:capturadb.database.windows.net,1433;Initial Catalog=homolog_jpproject;User Id=bruno@capturadb.database.windows.net;Password=8BIaspVxw1vOgSIDKdIn;"
            ASPNETCORE_ENVIRONMENT: "Development"
            ASPNETCORE_URLS: http://+:5000

    # #############################
    # # Management API
    # #############################
    jpproject-api:
        image: jpproject-api
        build: 
          context: .
          dockerfile: api.dockerfile
        ports:
            - "5003:80"
        depends_on:
            - jpdatabase
        environment: 
            DATABASE_TYPE: "SqlServer"
            CUSTOMCONNSTR_DATABASE_CONNECTION: "Data Source=tcp:capturadb.database.windows.net,1433;Initial Catalog=homolog_jpproject;User Id=bruno@capturadb.database.windows.net;Password=8BIaspVxw1vOgSIDKdIn;"
            ASPNETCORE_ENVIRONMENT: "Development"
            AUTHORITY: "http://jpproject:5000"
            ASPNETCORE_URLS: http://+

    #############################
    # User management UI
    #############################
    user-ui:
        image: jpproject-user-management-ui
        build: 
          context: .
          dockerfile: ui-user-management.dockerfile
        depends_on:
            - jpproject-api
            - jpproject
        ports:
            - 4200:80

    #############################
    # Admin Ui
    #############################
    admin-ui:
        image: jpproject-admin-ui
        build: 
          context: .
          dockerfile: admin-ui.dockerfile
        depends_on:
            - jpproject-api
            - jpproject
        ports:
            - 4300:80